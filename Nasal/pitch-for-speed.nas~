# This program is for changing the <Kp> number to get a more reliable
# pitching for speed behavior.

props.globals.initNode("autopilot/settings/target-speed-kt",0);
props.globals.initNode("instrumentation/airspeed-indicator/indicated-speed-kt",0);
props.globals.initNode("autopilot/internal/pitch-for-speed-kp",0);

var pitchForSpeedKp = func {

    var ias = getprop("instrumentation/airspeed-indicator/indicated-speed-kt");
    var set_speed = getprop("autopilot/settings/target-speed-kt");

    var diff_speed = ias - set_speed;

    if (diff_speed > 0) {
        var kp = -10;
    } else if (diff_speed <= 0) {
        var kp = -1;
    }setprop("autopilot/internal/pitch-for-speed-kp", kp);

    settimer(pitchForSpeedKp, 0);    
}

setlistener("controls/autopilot/settings/iasflag", pitchForSpeedKp);